<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Winiverse â€“ Universe of Winners</title>
  <link rel="stylesheet" href="css/common.css" />
  <link rel="stylesheet" href="css/index.css" />
</head>
<body>

<div class="header">
  <h1>Welcome to <span class="highlight">Winiverse</span> â€“ The Ultimate Universe of Winners!</h1>
</div>

<div class="search-section">
  <input type="text" id="visitorSearchBox" placeholder="Search by username or description" />
</div>

<!-- Leaderboard Section -->
<div class="leaderboard-section">
  <h2>ğŸ† Top 10 Leaderboard</h2>
  <ul id="leaderboard"></ul>
</div>

<!-- Main Content Grid -->
<div class="content-container" id="visitor-content-container"></div>

<!-- See More Button -->
<div class="see-more-section">
  <button class="btn-primary see-more-btn" id="seeMoreVisitorBtn" onclick="loadMoreContent()">See More</button>
</div>

<!-- Latest Wins Section moved here, list removed -->
<div class="latest-wins-section">
  <h2>ğŸ”¥ Latest Wins</h2>
</div>

<script>
  let visitorContentData = [];
  let itemsPerPage = 12;
  let currentPage = 1;

  async function loadContent() {
    try {
      const response = await fetch('/data.json');
      visitorContentData = await response.json();
      visitorContentData = visitorContentData.reverse();
      displayContent();
      updateLeaderboard();
      updateLatestWins();
    } catch (err) {
      console.error('Error loading content:', err);
    }
  }

  function displayContent(data = visitorContentData) {
    const container = document.getElementById('visitor-content-container');
    container.innerHTML = '';

    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const visibleData = data.slice(0, endIndex);

    visibleData.forEach(item => {
      const contentItem = document.createElement('div');
      contentItem.classList.add('content-item');

      contentItem.innerHTML = `
        <div class="content-card">
          <div class="content-image">
            <img src="${item.imageUrl}" alt="${item.username}">
          </div>
          <div class="content-info">
            <h3 class="username">${item.username}</h3>
            <p class="description">${item.description}</p>
            ${item.amount ? `<p class="amount">ğŸ’° â‚±${Number(item.amount).toLocaleString()}</p>` : ''}
            <a href="${item.link}" target="_blank" class="btn-primary">Start Your Winning Journey</a>
          </div>
        </div>
      `;

      container.appendChild(contentItem);
    });

    const seeMoreBtn = document.getElementById('seeMoreVisitorBtn');
    seeMoreBtn.style.display = endIndex < data.length ? 'block' : 'none';
  }

  function updateLeaderboard() {
    const leaderboard = document.getElementById('leaderboard');
    leaderboard.innerHTML = '';

    const top10 = [...visitorContentData]
      .filter(item => item.amount)
      .sort((a, b) => b.amount - a.amount)
      .slice(0, 10);

    top10.forEach((item, index) => {
      const li = document.createElement('li');
      li.textContent = `${index + 1}. ${item.username} â€“ â‚±${Number(item.amount).toLocaleString()}`;
      leaderboard.appendChild(li);
    });
  }

  function updateLatestWins() {
    const latestWins = document.getElementById('latestWins');
    if (latestWins) latestWins.remove(); // Remove the <ul> list if it exists
  }

  function loadMoreContent() {
    currentPage++;
    displayContent();
  }

  document.getElementById('visitorSearchBox').addEventListener('input', function () {
    const query = this.value.toLowerCase();
    const filteredData = visitorContentData.filter(item =>
      item.username.toLowerCase().includes(query) ||
      item.description.toLowerCase().includes(query)
    );
    currentPage = 1;
    displayContent(filteredData);
  });

  window.onload = loadContent;
</script>

</body>
</html>
